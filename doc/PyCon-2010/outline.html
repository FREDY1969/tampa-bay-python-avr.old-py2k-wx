<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Taking a New Look at Language and Compiler Technologies via the Arduino</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5196 2007-06-03 20:25:28Z wiemann $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="taking-a-new-look-at-language-and-compiler-technologies-via-the-arduino">
<h1 class="title">Taking a New Look at Language and Compiler Technologies via the Arduino</h1>

<div class="section" id="overview">
<h1>Overview</h1>
<div class="section" id="introduction">
<h2>Introduction</h2>
<ul class="simple">
<li>Modernize tradional compiler technologies<ul>
<li>found in the &quot;Dragon Book&quot;</li>
</ul>
</li>
<li>Modernize programming language technologies<ul>
<li>using these new compiler technologies</li>
</ul>
</li>
<li>Initially target the Arduino microcontroller (AVR instruction set)<ul>
<li>8 bit processor</li>
<li>32K bytes of flash memory (program storage)</li>
<li>2K bytes of RAM (data storage)</li>
<li>16MHz clock</li>
<li>32 (8-bit) registers</li>
<li>lots of hardware goodies!<ul>
<li>that this talk doesn't get into...</li>
</ul>
</li>
<li>later maybe ARM for the Lego Mindstorms NXT robots</li>
</ul>
</li>
<li>Write the compiler in Python as a &quot;hands-on&quot; programming exercise by the
Tampa Bay Python meetup group</li>
<li>What do you get?</li>
<li>How might this apply to other projects like, say, a Python compiler?</li>
</ul>
</div>
<div class="section" id="modernizing-compiler-technologies">
<h2>Modernizing Compiler Technologies</h2>
<ul class="simple">
<li>We're starting with: the &quot;Dragon Book&quot;<ul>
<li>Principles of Compiler Design, by Alfred V. Aho and Jeffrey D. Ullman<ul>
<li>I have the first edition, copyrighted 1977</li>
</ul>
</li>
</ul>
</li>
<li>Add these new technologies (that appeared after the book was written):<ul>
<li>A GUI forms-based question and answer mechanism<ul>
<li>as an alternative to formal syntax for declarations within the language</li>
</ul>
</li>
<li>Extensible, object-oriented interfaces<ul>
<li>to open up the internal workings of the compiler to library developers</li>
</ul>
</li>
<li>A relational database<ul>
<li>to make the results of compiler optimization analysis available to the
programmer</li>
</ul>
</li>
</ul>
</li>
<li>&quot;Stackless&quot; functions</li>
<li>Include the Dragon Book's global optimization algorithms<ul>
<li>that are typically not used in modern C compilers</li>
<li>split the concept of a &quot;compilation unit&quot;<ul>
<li>smaller units for the front-end<ul>
<li>individual declarations</li>
</ul>
</li>
<li>the whole program for the back-end</li>
<li>this means jettisoning separate compilation and the link editor
(or unix &quot;loader&quot;)</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="modernize-programming-language-technologies">
<h2>Modernize Programming Language Technologies</h2>
<ul class="simple">
<li>Develop a new microcontroller language</li>
<li>Allow the developers of large libraries to empower their users by writing
the libraries more as language extensions<ul>
<li>Boils down to allowing the library writer to write code that runs at
compile-time.<ul>
<li>for a microcontroller, the distinction between compile-time and run-time
is very clear!<ul>
<li>compile-time happens on the PC</li>
<li>run-time happens on the microcontroller</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Explore coroutine and green threading capabilities using &quot;stackless&quot;
functions<ul>
<li>for easier interrupt processing</li>
<li>static function activation records, rather than allocated in heap</li>
</ul>
</li>
<li>Repackage traditional compiler technologies to open them up to the
programmer<ul>
<li>as well as take advantage of the global flow analysis routines in the
&quot;Dragon Book&quot; that typical C compilers don't do</li>
</ul>
</li>
<li>Writing the compiler in Python allows a very small group to tackle a large
significant problem<ul>
<li>now anybody can bring their &quot;Evil Plan to Rule the World&quot; to fruition!<ul>
<li>and present at national conferences ;-)</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="exploring-new-extenisible-language-capabilities">
<h1>Exploring New Extenisible Language Capabilities</h1>
<p>(knowing that all previous attempts at extenisible languages were failures)!</p>
<ul class="simple">
<li>large libraries could benefit by the inclusion of compiler-like capabilities<ul>
<li>many decisions made at run-time in large libraries are based on factors
that don't change very often<ul>
<li>SQLAlchemy<ul>
<li>what data operations does the program need</li>
<li>what's your schema look like</li>
</ul>
</li>
<li>HTML templating</li>
</ul>
</li>
<li>what this ends up being is user code that runs at compile-time (rather
than run-time)</li>
</ul>
</li>
</ul>
<div class="section" id="meta-programming-programming-in-the-large">
<h2>Meta-programming (&quot;programming in the large&quot;)</h2>
<ul class="simple">
<li>user code that runs at compile-time (rather than run-time)</li>
<li>better run-time performance</li>
<li>new kinds of extensibility and abstraction<ul>
<li>programming languages are made up of<ul>
<li>lexical rules<ul>
<li>only reserved words are extensible</li>
</ul>
</li>
<li>expression syntax<ul>
<li>not extensible</li>
</ul>
</li>
<li>statement syntax<ul>
<li>extensible through new syntax<ul>
<li>thus, the parser is created on the fly (using PLY)</li>
</ul>
</li>
<li>done primary for extensible control statements</li>
</ul>
</li>
<li>declaration syntax<ul>
<li>this is where the focus is</li>
<li>&quot;folder == module&quot;, rather than &quot;file == module&quot;.</li>
<li>declarations have Q&amp;A plus (optional) text file<ul>
<li>most declarations can be handled entirely with Q&amp;A<ul>
<li>so adding new types of declarations doesn't add
syntactic clutter which reduces the &quot;surface area&quot;
of the language</li>
<li>declarations of how hardware will be used<ul>
<li>which generates the hardware configuration</li>
</ul>
</li>
<li>declarations of how libraries will be used</li>
</ul>
</li>
<li>the text file for each declaration is parsed separately<ul>
<li>lets different functions/declarations use different
parsers with different syntax<ul>
<li>high-level functions</li>
<li>assembler functions</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="re-skinning-the-dragon">
<h1>Re-Skinning the Dragon</h1>
<div class="section" id="compiler-uses-extensible-object-oriented-interfaces-internally-in-the-front-end">
<h2>Compiler uses extensible object-oriented interfaces internally in the front-end</h2>
<ul class="simple">
<li>for meta-programming hooks</li>
</ul>
</div>
<div class="section" id="ide-integrated-with-compiler">
<h2>IDE integrated with compiler</h2>
<ul class="simple">
<li>handles the Q&amp;A capability</li>
<li>makes internal compiler information available to the programmer<ul>
<li>cross reference information</li>
<li>program size and worst case execution times</li>
</ul>
</li>
<li>built on wxpython</li>
</ul>
</div>
<div class="section" id="stores-internal-compiler-data-in-relational-database">
<h2>Stores internal compiler data in relational database</h2>
<ul class="simple">
<li>symbol table</li>
<li>abstract syntax tree</li>
<li>use/definition analysis</li>
<li>makes this information available to the IDE</li>
<li>nice for debugging the compiler</li>
</ul>
</div>
<div class="section" id="optimizes-the-whole-program-including-called-library-routines-as-a-single-unit">
<h2>Optimizes the whole program (including called library routines) as a single unit</h2>
<ul class="simple">
<li>this means no separate link edit (loader) phase<ul>
<li>also libraries are no longer compiled once, for all to use</li>
</ul>
</li>
<li>so different &quot;compilation unit&quot; sizes for front-end and back-end<ul>
<li>smaller for the front-end (individual declaration rather than module)</li>
<li>and larger for the back-end (the whole program rather than module)</li>
</ul>
</li>
<li>lets the optimizer see the big picture</li>
<li>better register allocation across function calls</li>
<li>better mapping of functions to addresses to support the shorter Relative
Call instruction (1 word, 3 cycles vs 2 words, 4 cycles)</li>
<li>possible use for later Python compiler looking for order of magnitude
performance boost for Python<ul>
<li>can place module/class/instance variables at fixed offsets if they
are initialized at the creation of the containing object and are
never deleted.<ul>
<li>class/instance variables if no subclasses use multiple inheritance</li>
</ul>
</li>
<li>can optimize lookups to built in functions if their names are never
defined at the containing module level</li>
<li>can optimize function calls (parameter passing) to functions that
are never changed</li>
<li>can allocate function activation records on the stack for functions
that don't need coroutines or deferred execution</li>
<li>allocate objects in the longest living function activation record
that will use them<ul>
<li>to reduce how often the garbage collector has to run</li>
</ul>
</li>
<li>provide a benchmark for comparison to newer JIT technologies being
developed in the PyPy project</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="the-future">
<h1>The Future</h1>
<ul class="simple">
<li>We are exploring technical ideas on several levels that might be useful to
others<ul>
<li>new programming language ideas<ul>
<li>extensible declarations using Q&amp;A rather than syntax<ul>
<li>in the Python world, I'm thinking of large libraries like SQLAlchemy or
Django.<ul>
<li>Doing Zope right??</li>
</ul>
</li>
</ul>
</li>
<li>extensible control statements<ul>
<li>don't really know whether or how this would fit in with Python</li>
</ul>
</li>
</ul>
</li>
<li>new compiler ideas<ul>
<li>stackless<ul>
<li>coroutines/generators<ul>
<li>suspendable consumers as well as producers</li>
<li>objects representing the consumer that can be passed around (like
iterators objects represent the producer)</li>
<li>make more explicit the difference between generating values to a
consumer vs finally returning from the generator when there are no
more values</li>
</ul>
</li>
<li>green threads<ul>
<li>to avoid &quot;event programming&quot; in traditional GUI applications</li>
<li>to multi-thread server applications<ul>
<li>in the Python world, this would be &quot;Twisted for free&quot;</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>use of relational database<ul>
<li>IDE: letting the programmer know what the compiler knows</li>
</ul>
</li>
<li>global flow analysis<ul>
<li>improve Python performance by an order of magnitude or more (10x-50x)<ul>
<li>by recognizing special cases that dominate our use of language<ul>
<li>variables never deleted can be assigned to fixed offsets</li>
<li>instance variables assigned to fixed offsets when no multiple
inheritance is used in derived classes</li>
<li>direct calls to builtin functions when their names are never
defined in the module</li>
<li>direct calls to functions that are never redefined</li>
<li>placing function activation records on a stack when the function
doesn't need stackless capability</li>
<li>figuring out actual to formal parameter mappings at compile time
when the function is never redefined</li>
<li>multiple entry points for different numbers of parameters, or
different saving different sets of registers</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>We are also exploring using a complicated hands-on project for a local Python
group that can really show the benefits of developing in Python.</li>
<li>What we've learned so far.<ul>
<li>to be determined...</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="notes-for-reviewers">
<h1>Notes for Reviewers</h1>
<p>I expect that most of the audience will not be interested, or knowledgeable,
in microcontrollers.  I only plan to give a very brief overview of the
microcontroller's capabilities, from a programming perspective (ignoring
the hardware goodies).  And I am not planning on presenting the syntax for
this language, as I don't see it as scalable to larger programming arenas.</p>
<p>Rather, I'm focusing on broader concepts that may be useful in other domains.
As 30 minutes does not allow enough time to go into detail, this talk will
assume some knowledge of compiler technology by the audience.  Thus, I have
labeled this as an advanced talk.</p>
<p>The project development is about half-way through, so we haven't quite gotten
to the point of seeing how well these ideas work in practice.</p>
<p>I expect to have a running prototype by the conference date, and that we will
be just starting to get a feel for how well these ideas work by then.  This
will affect this presentation somewhat (especially the Conclusion section).</p>
<p>Finally, I will be paying my own way to the conference and asking for
financial aid.  At this time, I don't know if any other members of the Tampa
Bay Python meetup group will be attending the conference.  Alas, their paying
jobs are not using Python...</p>
</div>
</div>
</body>
</html>
